name: Run mega-nz.yaml per link (no matrix)

on:
  workflow_dispatch:
    inputs:
      mega_urls:
        description: 'MEGA.nz URLs (comma or space separated)'
        required: true

jobs:
  process-links:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install jq (for processing JSON if needed)
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Loop through links and call reusable workflow or script
        shell: bash
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          URLS=$(echo "${{ github.event.inputs.mega_urls }}" | tr ',' ' ')
          for url in $URLS; do
            echo "Processing link: $url"
            # Example: Call mega-nz.yaml using GitHub REST API workflow dispatch (replace owner/repo/workflow)
            curl -X POST "https://api.github.com/repos/${{ github.repository }}/actions/workflows/mega-nz.yaml/dispatches" \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer $GITHUB_TOKEN" \
              -d "{\"ref\":\"${{ github.ref }}\", \"inputs\": {\"mega_urls\": \"$url\"}}"
            # Optional: Add sleep to avoid API rate limits
            sleep 3
          done
